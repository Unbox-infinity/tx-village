version: "0.5"

processes:
  tests:
    command: cargo test
    depends_on:
      cardano_devnet:
        condition: process_healthy
      ogmios:
        condition: process_healthy

  cardano_devnet:
    command: cardano-devnet
    readiness_probe:
      exec:
        command: "cardano-cli query tip --socket-path .devnet/node.socket --testnet-magic 42"
      initial_delay_seconds: 1
      period_seconds: 1

  ogmios:
    command: "ogmios --node-socket .devnet/node.socket --node-config .devnet/config.json"
    readiness_probe:
      http_get: 
        host: 127.0.0.1
        port: 1337
        path: "/health"
      initial_delay_seconds: 2
      period_seconds: 2
    depends_on:
      cardano_devnet:
        condition: process_healthy
